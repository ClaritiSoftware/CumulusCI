<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="author" title="About these documents" href="about.html" /><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Acceptance Testing with Robot Framework" href="robot.html" /><link rel="prev" title="Develop a Project" href="dev.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>Automate Data Operations - CumulusCI 4.6.0.dev1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">CumulusCI 4.6.0.dev1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">CumulusCI 4.6.0.dev1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">The <code class="docutils literal notranslate"><span class="pre">cci</span></code> Command Line</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="config.html">Configure CumulusCI</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Configure CumulusCI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="deploy.html">Configure Metadata Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scratch-orgs.html">Manage Scratch Orgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="connected-orgs.html">Connect Persistent Orgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Develop a Project</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Automate Data Operations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="robot.html">Acceptance Testing with Robot Framework</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Acceptance Testing with Robot Framework</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="robot-locators.html">Managing Locators</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-advanced.html">Robot Advanced Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-tutorial.html">Robot Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-debugger.html">Robot Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-playwright.html">Playwright Technology Preview</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="continuous-integration.html">Continuous Integration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Continuous Integration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="cumulusci-flow.html">CumulusCI Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="github-actions.html">Run CumulusCI from GitHub Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="2gp-testing.html">Testing with Second-Generation Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="headless.html">Run CumulusCI Headlessly</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="packaging.html">Release Managed and Unlocked Packages</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Release Managed and Unlocked Packages</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="managed-package.html">Release a First-Generation Managed Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="managed-2gp.html">Release a Second-Generation Managed Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="unlocked-package.html">Release an Unlocked Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="npsp-eda-2gp.html">Extend NPSP and EDA with Second-Generation Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="release-notes.html">Generate Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="push-upgrades.html">Manage Push Upgrades</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="unpackaged.html">Manage Unpackaged Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Manage Unpackaged Configuration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="metadata-etl.html">Metadata ETL</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="cheat-sheet.html">Cheat Sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="flows.html">Flow Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="env-var-reference.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="org_config-reference.html">org_config Object Reference</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="about.html">About CumulusCI</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of About CumulusCI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contribute to CumulusCI</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">History</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/data.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="automate-data-operations">
<h1>Automate Data Operations<a class="headerlink" href="#automate-data-operations" title="Link to this heading">¶</a></h1>
<p>CumulusCI offers a suite of tasks to help you to manage data as part of
your project automation. Within your repository, you can define one or
several <em>datasets</em>, collections of data you use for specific purposes.
CumulusCI tasks support extracting defined datasets from scratch orgs or
persistent orgs, storing those snapshots within the repository, and
automating the load of datasets into orgs. Data operations are executed
via the Bulk and REST APIs.</p>
<p>CumulusCI has both high level tasks for working with Sample Datasets
and low-level tasks for generic Extract, Transform and Load of
any data.</p>
<section id="sample-data">
<h2>Sample Data<a class="headerlink" href="#sample-data" title="Link to this heading">¶</a></h2>
<p>Note: Sample Data features are still under active
development and may change based on user feedback.</p>
<p>CumulusCI has easy to use tasks for working with the primary
sample datasets used for projects. There is a ‘default’ dataset
which would be used in scratch org configuration flows, as well
as other datasets specific to the needs of specific scratch org configurations.</p>
<p>For example, the ‘dev’ dataset is for ‘dev’ orgs, and it is used
instead of the default dataset if it exists.</p>
<p>You can create a dataset by extracting data from an existing org
or by authoring a <a class="reference internal" href="#generate-fake-data">Snowfakery recipe</a>.
Extracting from an existing org is easy for use-cases where the
data already exists or can be readily created in an org. Snowfakery
is better for cases where either a) you would like to dynamically
generate data, or b) you would rather edit static data in a text
editor.</p>
<p>A Snowfakery dataset can consist of a single file with a name like
<code class="docutils literal notranslate"><span class="pre">datasets/&lt;datasetname&gt;/&lt;datasetname&gt;.recipe.yml</span></code> . For example,
<code class="docutils literal notranslate"><span class="pre">datasets/default/default.recipe.yml</span></code> or
<code class="docutils literal notranslate"><span class="pre">datasets/qa/qa.recipe.yml</span></code>. The rest of what you need to know
about Snowfakery is in the section <a class="reference internal" href="#generate-fake-data">Generate Fake Data</a>.</p>
<section id="extracting-and-loading-sample-datasets">
<h3>Extracting and Loading Sample Datasets<a class="headerlink" href="#extracting-and-loading-sample-datasets" title="Link to this heading">¶</a></h3>
<p>In the simplest case, you can extract all data from an org
using the task <code class="docutils literal notranslate"><span class="pre">capture_sample_data</span></code> like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cci<span class="w"> </span>task<span class="w"> </span>run<span class="w"> </span>capture_sample_data<span class="w"> </span>--org<span class="w"> </span>orgname
</pre></div>
</div>
<p>That will extract the data from the Salesforce
org named <code class="docutils literal notranslate"><span class="pre">orgname</span></code> into the dataset named <code class="docutils literal notranslate"><span class="pre">default</span></code>.</p>
<p>You can then load it into any target org (e.g.
<code class="docutils literal notranslate"><span class="pre">org2</span></code>) like this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cci<span class="w"> </span>task<span class="w"> </span>run<span class="w"> </span>load_sample_data<span class="w"> </span>--org<span class="w"> </span>org2
</pre></div>
</div>
<p>A main benefit of sample datasets is that they are always
loaded automatically into scratch orgs by the scratch org
setup flows like <code class="docutils literal notranslate"><span class="pre">dev_org</span></code> and <code class="docutils literal notranslate"><span class="pre">qa_org</span></code>.</p>
<p>The exact subset of data captured depends on heuristics
that may change over time, so do not depend on this task
in a highly automated situation. It is designed to be
used interactively, and you can control its behavior
with an <a class="reference internal" href="data/extract_declarations.html"><span class="std std-doc">Extract Declaration</span></a> file.</p>
<p>The extract process generates a mapping YAML file which will be used for subsequent
loads. It has the name <code class="docutils literal notranslate"><span class="pre">datasets/&lt;datasetname&gt;/&lt;datasetname&gt;.mapping.yml</span></code>.
It is possible to edit this file, but this may not be the best choice.
Changes to the file can be overwritten when you capture data a second time.
Rather than editing the file, it is preferable to create a Loading Rules
file and then re-create the mapping file by capturing sample data again.</p>
<p>A Loading Rules file is a file named
<code class="docutils literal notranslate"><span class="pre">datasets/&lt;datasetname&gt;/&lt;datasetname&gt;.load.yml</span></code> which can specify instructions
like which API to use and in which order to load objects. This file is in
the <a class="reference internal" href="data/loading_rules.html"><span class="std std-doc">Loading Rules</span></a> format. If you create such a file
and then re-capture sample data, the mapping file will be updated to match.</p>
</section>
<section id="multiple-sample-datasets">
<h3>Multiple Sample Datasets<a class="headerlink" href="#multiple-sample-datasets" title="Link to this heading">¶</a></h3>
<p>If you want different datasets for different scratch org types
(e.g. QA orgs verus Dev orgs) then you can change the data
loaded by those types by making datasets specific to each one.
This data will load instead of the default dataset.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cci<span class="w"> </span>task<span class="w"> </span>run<span class="w"> </span>capture_sample_data<span class="w"> </span>--dataset<span class="w"> </span>dev<span class="w"> </span>--org<span class="w"> </span>org1
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cci<span class="w"> </span>task<span class="w"> </span>run<span class="w"> </span>capture_sample_data<span class="w"> </span>--dataset<span class="w"> </span>qa<span class="w"> </span>--org<span class="w"> </span>org2
</pre></div>
</div>
<p>This would create two datasets in <code class="docutils literal notranslate"><span class="pre">datasets/dev</span></code> and <code class="docutils literal notranslate"><span class="pre">datasets/qa</span></code>
which would be loaded instead of <code class="docutils literal notranslate"><span class="pre">datasets/default</span></code>. You can
create as many datasets as you want.</p>
<p>You can download just a subset of the objects or fields in an org with
an <a class="reference internal" href="data/extract_declarations.html"><span class="std std-doc">Extract Declaration</span></a> file.</p>
</section>
</section>
<section id="low-level-datasets">
<h2>Low level datasets<a class="headerlink" href="#low-level-datasets" title="Link to this heading">¶</a></h2>
<p>A dataset consists of:</p>
<ul class="simple">
<li><p>a <em>definition file</em>, written in YAML, which specifies the sObjects
and fields contained in the dataset and the order in which they are
loaded or extracted from an org.</p></li>
<li><p>a <em>storage location</em>, which may take the form of a SQL database
(typically, a SQLite file stored within the repository, although
external databases are supported) or a SQL script file.</p></li>
</ul>
<p>Datasets are stored in the <code class="docutils literal notranslate"><span class="pre">datasets/</span></code> folder within a repository by
default. Projects created with a recent version of CumulusCI ship with
this directory in place.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code> is called without any path options, it will automatically use a dataset that matches the org shape, if one exists. For example, a <code class="docutils literal notranslate"><span class="pre">dev</span></code> org will automatically use a dataset that exists at <code class="docutils literal notranslate"><span class="pre">datasets/dev/</span></code>. Within that folder, two files must exist, also matching the org shape name: <code class="docutils literal notranslate"><span class="pre">dev.mapping.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">dev.dataset.sql</span></code>, in this example. If the directory or files do not exist and no paths options were specified, the task will look for <code class="docutils literal notranslate"><span class="pre">datasets/mapping.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">datasets/dataset.sql</span></code> by default. When the <code class="docutils literal notranslate"><span class="pre">default_dataset_only</span></code> option is <code class="docutils literal notranslate"><span class="pre">True</span></code>, this overrides any path options and default files and looks <em>only</em> for a dataset directory that matches the org shape name. The <code class="docutils literal notranslate"><span class="pre">default_dataset_only</span></code> option defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>In addition, <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code> is included in <code class="docutils literal notranslate"><span class="pre">config_dev</span></code>, <code class="docutils literal notranslate"><span class="pre">config_qa</span></code>, and <code class="docutils literal notranslate"><span class="pre">config_managed</span></code>, so it is automatically called when running most org setup flows. In this context, it runs with <code class="docutils literal notranslate"><span class="pre">default_dataset_only</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, to avoid double loading for backwards compatibility with customer flows that are already customized to call <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code>.</p>
</section>
<section id="the-lifecycle-of-a-dataset">
<h2>The Lifecycle of a Dataset<a class="headerlink" href="#the-lifecycle-of-a-dataset" title="Link to this heading">¶</a></h2>
<p>A dataset starts with a definition: which objects, and which fields, are
to be captured, persisted, and loaded into orgs? (The details of
definition file format are covered below).</p>
<p>With a definition available, the dataset may be captured from an org
into the repository. A captured dataset may be stored under version
control and incorporated into project automation, loaded as part of
flows during org builds or at need. As the project’s needs evolve,
datasets may be re-captured from orgs and versioned alongside the
project metadata.</p>
<p>Projects may define one or many datasets. Datasets can contain an
arbitrary amount of data.</p>
</section>
<section id="defining-datasets">
<h2>Defining Datasets<a class="headerlink" href="#defining-datasets" title="Link to this heading">¶</a></h2>
<p>A dataset is defined in YAML as a series of steps. Each step registers a
specific sObject as part of the dataset, and defines the relevant fields
on that sObject as well as its relationships to other sObjects that are
included in the data set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section discusses how to define a dataset and the format of
the definition file. In many cases, it’s easier to use the
<code class="docutils literal notranslate"><span class="pre">generate_dataset_mapping</span></code> task than to create this definition by
hand. See below for more details.</p>
</div>
<p>A simple dataset definition looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Accounts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Description</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RecordTypeId</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ParentId</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">            </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Accounts</span>
<span class="nt">Contacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Contact</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FirstName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LastName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Email</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">AccountId</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
</pre></div>
</div>
<p>This example defines two steps: <code class="docutils literal notranslate"><span class="pre">Accounts</span></code> and <code class="docutils literal notranslate"><span class="pre">Contacts</span></code>. (The names of
steps are arbitrary). Each step governs the extraction or load of
records in the sObject denoted in its <code class="docutils literal notranslate"><span class="pre">sf_object</span></code> property.</p>
<p>Relationships are defined in the <code class="docutils literal notranslate"><span class="pre">lookups</span></code> section. Each key within
<code class="docutils literal notranslate"><span class="pre">lookups</span></code> is the API name of the relationship field. Beneath, the
<code class="docutils literal notranslate"><span class="pre">table</span></code> key defines the stored table to which this relationship refers.</p>
<p>CumulusCI loads steps in order. However, sObjects earlier in the
sequence of steps may include lookups to sObjects loaded later, or to
themselves. For these cases, the <code class="docutils literal notranslate"><span class="pre">after</span></code> key may be included in a lookup
definition, with a value set to the name of the step after which the
referenced record is expected to be available. CumulusCI will defer
populating the lookup field until the referenced step has been
completed. In the example above, an <code class="docutils literal notranslate"><span class="pre">after</span></code> definition is used to
support the <code class="docutils literal notranslate"><span class="pre">ParentId</span></code> self-lookup on <code class="docutils literal notranslate"><span class="pre">Account</span></code>.</p>
<section id="api-selection">
<span id="id1"></span><h3>API Selection<a class="headerlink" href="#api-selection" title="Link to this heading">¶</a></h3>
<p>By default, CumulusCI will determine the data volume of the specified
object and select an API for you: for under 2,000 records, the REST
Collections API is used; for more, the Bulk API is used. The Bulk API is
also used for delete operations where the hard delete operation is
requested, as this is available only in the Bulk API. Smart API
selection helps increase speed for low- and moderate-volume data loads.</p>
<p>To prefer a specific API, set the <code class="docutils literal notranslate"><span class="pre">api</span></code> key within any mapping step;
allowed values are <code class="docutils literal notranslate"><span class="pre">&quot;rest&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;bulk&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;smart&quot;</span></code>, the default.</p>
<p>CumulusCI defaults to using the Bulk API in Parallel mode. If required
to avoid row locks, specify the key <code class="docutils literal notranslate"><span class="pre">bulk_mode:</span> <span class="pre">Serial</span></code> in each step
requiring the use of serial mode.</p>
<p>For all API modes, you can specify a batch size using the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>
key. Allowed values are between 1 and 200 for the REST API and 1 and
10,000 for the Bulk API.</p>
<p>Note that the semantics of batch sizes differ somewhat between the REST
API and the Bulk API. In the REST API, the batch size is the size of
upload batches and also the actual size of individual transactions. In
the Bulk API, the batch size is the maximum record count in a Bulk API
upload batch, which is subject to its own limits, including restrictions
on total processing time. Bulk API batches are automatically chunked
further into transactions by the platform, and the transaction size
cannot be controlled.</p>
</section>
<section id="upserts">
<h3>Upserts<a class="headerlink" href="#upserts" title="Link to this heading">¶</a></h3>
<p>The definition of “upsert” is an operation which creates new records
and updates existing records depending on a field (the update key) which
determines whether the input row and the existing row are “the same”.</p>
<p>You can do ID-based,
<a class="reference external" href="https://developer.salesforce.com/docs/atlas.en-us.204.0.object_reference.meta/object_reference/access_for_fields.htm##access_lookup">idLookup-based</a>
and <a class="reference external" href="https://help.salesforce.com/s/articleView?id=sf.faq_import_general_what_is_an_external.htm&amp;amp;type=5">external
ID</a>-based
<a class="reference external" href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/langCon_apex_dml_examples_upsert.htm">upserts</a>
and updates by specifying additional settings in a mapping step.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Insert Accounts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">upsert</span>
<span class="w">    </span><span class="nt">update_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Extid__c</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Extid__c</span>
</pre></div>
</div>
<p>Whenever <code class="docutils literal notranslate"><span class="pre">update_key</span></code> is supplied, the action must be <code class="docutils literal notranslate"><span class="pre">upsert</span></code> and vice
versa.</p>
</section>
<hr class="docutils" />
<section id="selects">
<h3>Selects<a class="headerlink" href="#selects" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">select</span></code> functionality is designed to streamline the mapping process by enabling the selection of specific records directly from Salesforce for lookups. This feature is particularly useful when dealing with non-insertable Salesforce objects and ensures that pre-existing records are used rather than inserting new ones. The selection process is highly customizable with various strategies, filters, and additional capabilities that provide flexibility and precision in data mapping.</p>
<p>The following is an example of a <code class="docutils literal notranslate"><span class="pre">mapping.yaml</span></code> file where the <code class="docutils literal notranslate"><span class="pre">Event</span></code> sObject utilizes the <code class="docutils literal notranslate"><span class="pre">select</span></code> action:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Account</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Description</span>

<span class="nt">Contact</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Contact</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LastName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Email</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">AccountId</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>

<span class="nt">Lead</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lead</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LastName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Company</span>

<span class="nt">Event</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Event</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select</span>
<span class="w">    </span><span class="nt">select_options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">similarity</span>
<span class="w">        </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WHERE Subject LIKE &#39;Meeting%&#39;</span>
<span class="w">        </span><span class="nt">priority_fields</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Subject</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WhoId</span>
<span class="w">        </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Subject</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DurationInMinutes</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ActivityDateTime</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">WhoId</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Contact</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lead</span>
<span class="w">        </span><span class="nt">WhatId</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
</pre></div>
</div>
<hr class="docutils" />
<section id="selection-strategies">
<h4>Selection Strategies<a class="headerlink" href="#selection-strategies" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">strategy</span></code> parameter determines how records are selected from the target org. It is <strong>optional</strong>; if no strategy is specified, the <code class="docutils literal notranslate"><span class="pre">standard</span></code> strategy will be applied by default.</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">standard</span></code> Strategy:</strong><br />
The <code class="docutils literal notranslate"><span class="pre">standard</span></code> selection strategy retrieves records from target org in the same order as they appear, applying any specified filters and sorting criteria. This method ensures that records are selected without any prioritization based on similarity or randomness, offering a straightforward way to pull the desired data.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">similarity</span></code> Strategy:</strong><br />
The <code class="docutils literal notranslate"><span class="pre">similarity</span></code> strategy is used when you need to find records in the target org that closely resemble the records defined in your SQL file. This strategy performs a similarity match between the records in the SQL file and those in the target org. In addition to comparing the fields of the record itself, this strategy includes the fields of parent records (up to one level) for a more granular and accurate match.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">random</span></code> Strategy:</strong><br />
The <code class="docutils literal notranslate"><span class="pre">random</span></code> selection strategy randomly assigns records picked from the target org. This method is useful when the selection order does not matter, and you simply need to fetch records in a randomized manner.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="selection-filters">
<h4>Selection Filters<a class="headerlink" href="#selection-filters" title="Link to this heading">¶</a></h4>
<p>The selection <code class="docutils literal notranslate"><span class="pre">filter</span></code> provides a flexible way to refine the records selected by using any functionality supported by SOQL. This includes filtering, sorting, and limiting records based on specific conditions, such as using the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause to filter records by field values, the <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause to sort records in ascending or descending order, and the <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> clause to restrict the number of records returned. Essentially, any feature available in SOQL for record selection is supported here, allowing you to tailor the selection process to your precise needs and ensuring only the relevant records are included in the mapping process.</p>
<p>This parameter is <strong>optional</strong>; and if not specified, no filter will apply.</p>
</section>
<hr class="docutils" />
<section id="priority-fields">
<h4>Priority Fields<a class="headerlink" href="#priority-fields" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">priority_fields</span></code> feature enables you to specify a subset of fields in your mapping step that will have more weight during the similarity matching process. When similarity matching is performed, these priority fields will be given greater importance compared to other fields, allowing for a more refined match.</p>
<p>This parameter is <strong>optional</strong>; and if not specified, all fields will be considered with same priority.</p>
<p>This feature is particularly useful when certain fields are more critical in defining the identity or relevance of a record, ensuring that these fields have a stronger influence in the selection process.</p>
</section>
<hr class="docutils" />
<section id="threshold">
<h4>Threshold<a class="headerlink" href="#threshold" title="Link to this heading">¶</a></h4>
<p>This feature allows you to either select or insert records based on a similarity threshold. When using the <code class="docutils literal notranslate"><span class="pre">select</span></code> action with the <code class="docutils literal notranslate"><span class="pre">similarity</span></code> strategy, you can specify a <code class="docutils literal notranslate"><span class="pre">threshold</span></code> value between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code>, where <code class="docutils literal notranslate"><span class="pre">0</span></code> represents a perfect match and <code class="docutils literal notranslate"><span class="pre">1</span></code> signifies no similarity.</p>
<ul class="simple">
<li><p><strong>Select Records:</strong><br />
If a record from your SQL file has a similarity score below the threshold, it will be selected from the target org.</p></li>
<li><p><strong>Insert Records:</strong><br />
If the similarity score exceeds the threshold, the record will be inserted into the target org instead of being selected.</p></li>
</ul>
<p>This parameter is <strong>optional</strong>; if not specified, no threshold will be applied and all records will default to be selected.</p>
<p>This feature is particularly useful during version upgrades, where records that closely match can be selected, while those that do not match sufficiently can be inserted into the target org.</p>
<p><strong>Important Note:</strong><br />
For high volumes of records, an approximation algorithm is applied to improve performance. In such cases, setting a threshold of <code class="docutils literal notranslate"><span class="pre">0</span></code> may not guarantee the selection of exact matches, as the algorithm can assign a small non-zero similarity score to exact matches. To ensure accurate selection, it is recommended to set the threshold to a small value slightly greater than <code class="docutils literal notranslate"><span class="pre">0</span></code>, such as <code class="docutils literal notranslate"><span class="pre">0.1</span></code>. This ensures both precision and efficiency in the selection process.</p>
</section>
<hr class="docutils" />
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h4>
<p>To demonstrate the <code class="docutils literal notranslate"><span class="pre">select</span></code> functionality, consider the example of the <code class="docutils literal notranslate"><span class="pre">Event</span></code> entity, which utilizes the <code class="docutils literal notranslate"><span class="pre">similarity</span></code> strategy, a filter condition, and other advanced options to select matching records effectively as given in the yaml above.</p>
<ol class="arabic simple">
<li><p><strong>Basic Object Configuration</strong>:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Account</span></code>, <code class="docutils literal notranslate"><span class="pre">Contact</span></code>, and <code class="docutils literal notranslate"><span class="pre">Lead</span></code> objects are configured for straightforward field mapping.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">lookup</span></code> is defined on the <code class="docutils literal notranslate"><span class="pre">Contact</span></code> object to map <code class="docutils literal notranslate"><span class="pre">AccountId</span></code> to the <code class="docutils literal notranslate"><span class="pre">Account</span></code> table.</p></li>
</ul>
</li>
<li><p><strong>Advanced <code class="docutils literal notranslate"><span class="pre">Event</span></code> Object Mapping</strong>:</p>
<ul class="simple">
<li><p><strong>Action</strong>: The <code class="docutils literal notranslate"><span class="pre">Event</span></code> object uses the <code class="docutils literal notranslate"><span class="pre">select</span></code> action, meaning records are selected rather than inserted.</p></li>
<li><p><strong>Strategy</strong>: The <code class="docutils literal notranslate"><span class="pre">similarity</span></code> strategy matches <code class="docutils literal notranslate"><span class="pre">Event</span></code> records in target org that are similar to those defined in the SQL file.</p></li>
<li><p><strong>Filter</strong>: Only <code class="docutils literal notranslate"><span class="pre">Event</span></code> records with a <code class="docutils literal notranslate"><span class="pre">Subject</span></code> field starting with “Meeting” are considered.</p></li>
<li><p><strong>Priority Fields</strong>: The <code class="docutils literal notranslate"><span class="pre">Subject</span></code> and <code class="docutils literal notranslate"><span class="pre">WhoId</span></code> fields are given more weight during similarity matching.</p></li>
<li><p><strong>Threshold</strong>: A similarity score of 0.3 is used to determine whether records are selected or inserted.</p></li>
<li><p><strong>Lookups</strong>:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">WhoId</span></code> field looks up records from either the <code class="docutils literal notranslate"><span class="pre">Contact</span></code> or <code class="docutils literal notranslate"><span class="pre">Lead</span></code> objects.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">WhatId</span></code> field looks up records from the <code class="docutils literal notranslate"><span class="pre">Account</span></code> object.</p></li>
</ul>
</li>
</ul>
</li>
</ol>
<p>This example highlights how the <code class="docutils literal notranslate"><span class="pre">select</span></code> functionality can be applied in real-world scenarios, such as selecting <code class="docutils literal notranslate"><span class="pre">Event</span></code> records that meet specific criteria while considering similarity, filters, and priority fields.</p>
</section>
</section>
<hr class="docutils" />
<section id="database-mapping">
<h3>Database Mapping<a class="headerlink" href="#database-mapping" title="Link to this heading">¶</a></h3>
<p>CumulusCI’s definition format includes considerable flexibility for use
cases where datasets are stored in SQL databases whose structure is not
identical to the Salesforce database. Salesforce objects may be assigned
to arbitrary database tables, and Salesforce field names mapped to
arbitrary columns.</p>
<p>For new mappings, it’s recommended to allow CumulusCI to use sensible
defaults by specifying only the Salesforce entities. Legacy datasets are
likely to include explicit database mappings, which would look like this
for the same data model as above:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Accounts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Description</span>
<span class="w">        </span><span class="nt">RecordTypeId</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RecordTypeId</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ParentId</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">            </span><span class="nt">after</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Accounts</span>
<span class="nt">Contacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Contact</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Contact</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="nt">FirstName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FirstName</span>
<span class="w">        </span><span class="nt">LastName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LastName</span>
<span class="w">        </span><span class="nt">Email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Email</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">AccountId</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
</pre></div>
</div>
<p>Note that in this version, fields are specified as a colon-separated
mapping, not a list. Each pair in the field map is structured as
<code class="docutils literal notranslate"><span class="pre">Salesforce</span> <span class="pre">API</span> <span class="pre">Name:</span> <span class="pre">Database</span> <span class="pre">Column</span> <span class="pre">Name</span></code>. Additionally, each object
has a <code class="docutils literal notranslate"><span class="pre">table</span></code> key to specify the underlying database table.</p>
<p>New mappings that do not connect to an external SQL database (that is,
mappings which simply extract and load data between Salesforce orgs)
should not need to use this feature, and new mappings that are generated
by CumulusCI use the simpler version shown above. Existing mappings may
be converted to this streamlined style in most cases by loading the
existing dataset, modifying the mapping file, and then extracting a
fresh copy of the data. Note however that datasets which make use of
older and deprecated CumulusCI features, such as the <code class="docutils literal notranslate"><span class="pre">record_type</span></code> key,
may need to continue using explicit database mapping.</p>
</section>
<section id="record-types">
<h3>Record Types<a class="headerlink" href="#record-types" title="Link to this heading">¶</a></h3>
<p>CumulusCI supports automatic mapping of Record Types between orgs, keyed
upon the Developer Name. To take advantage of this support, simply
include the <code class="docutils literal notranslate"><span class="pre">RecordTypeId</span></code> field in any step. CumulusCI will
transparently extract Record Type information during dataset capture and
map Record Types by Developer Name into target orgs during loads.</p>
<p>Older dataset definitions may also use a <code class="docutils literal notranslate"><span class="pre">record_type</span></code> key:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Accounts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">    </span><span class="nt">record_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Organization</span>
</pre></div>
</div>
<p>This feature limits extraction to records possessing that specific
Record Type, and assigns the same Record Type upon load.</p>
<p>It’s recommended that new datasets use Record Type mapping by including
the <code class="docutils literal notranslate"><span class="pre">RecordTypeId</span></code> field. Using <code class="docutils literal notranslate"><span class="pre">record_type</span></code> will result in CumulusCI
issuing a warning.</p>
</section>
<section id="relative-dates">
<h3>Relative Dates<a class="headerlink" href="#relative-dates" title="Link to this heading">¶</a></h3>
<p>CumulusCI supports maintaining <em>relative dates</em>, helping to keep the
dataset relevant by ensuring that date and date-time fields are updated
when loaded.</p>
<p>Relative dates are enabled by defining an <em>anchor date</em>, which is
specified in each mapping step with the <code class="docutils literal notranslate"><span class="pre">anchor_date</span></code> key, whose value
is a date in the format <code class="docutils literal notranslate"><span class="pre">2020-07-01</span></code>.</p>
<p>When you specify a relative date, CumulusCI modifies all date and
date-time fields on the object such that when loaded, they have the same
relationship to today as they did to the anchor date. Hence, given a
stored date of 2020-07-10 and an anchor date of 2020-07-01, if you
perform a load on 2020-09-10, the date field will be rendered as
2020-09-19 -nine days ahead of today’s date, as it was nine days ahead
of the anchor date.</p>
<p>Relative dates are also adjusted upon extract so that they remain
stable. Extracting the same data mentioned above would result in
CumulusCI adjusting the date back to 2020-07-10 for storage, keeping it
relative to the anchor date.</p>
<p>Relative dating is applied to all date and date-time fields on any
mapping step that contains the <code class="docutils literal notranslate"><span class="pre">anchor_date</span></code> clause. If orgs are
<a class="reference external" href="https://help.salesforce.com/articleView?id=000334139&amp;amp;language=en_US&amp;amp;type=1&amp;amp;mode=1">configured</a>
to permit setting audit fields upon record creation and the appropriate
user permission is enabled, CumulusCI can apply relative dating to audit
fields, such as <code class="docutils literal notranslate"><span class="pre">CreatedDate</span></code>. For more about how to automate that
setup, review the <code class="docutils literal notranslate"><span class="pre">create_bulk_data_permission_set</span></code> task below.</p>
<p>For example, this mapping step:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Contacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Contact</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FirstName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LastName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Birthdate</span>
<span class="w">    </span><span class="nt">anchor_date</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1990-07-01</span>
</pre></div>
</div>
<p>would adjust the <code class="docutils literal notranslate"><span class="pre">Birthdate</span></code> field on both load and extract around the
anchor date of July 1, 1990. Note that date and datetime fields not
mapped, as well as fields on other steps, are unaffected.</p>
</section>
<section id="person-accounts">
<h3>Person Accounts<a class="headerlink" href="#person-accounts" title="Link to this heading">¶</a></h3>
<p>CumulusCI supports extracting and loading person account data. In your
dataset definition, map person account fields like <code class="docutils literal notranslate"><span class="pre">LastName</span></code>,
<code class="docutils literal notranslate"><span class="pre">PersonBirthdate</span></code>, or <code class="docutils literal notranslate"><span class="pre">CustomContactField__pc</span></code> to <strong>Account</strong> steps
(i.e. where <code class="docutils literal notranslate"><span class="pre">sf_object</span></code> equals <strong>Account</strong>).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Account</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="c1">## Business Account Fields</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AccountNumber</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BillingStreet</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BillingCity</span>

<span class="w">        </span><span class="c1">## Person Account Fields</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FirstName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LastName</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersonEmail</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CustomContactField__pc</span>

<span class="w">        </span><span class="c1">## Optional (though recommended) Record Type</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RecordTypeId</span>
</pre></div>
</div>
<section id="id2">
<h4>Record Types<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<p>It’s recommended, though not required, to extract Account Record Types
to support datasets with person accounts so there is consistency in the
Account record types loaded. If Account <code class="docutils literal notranslate"><span class="pre">RecordTypeId</span></code> is not extracted,
the default business account Record Type and default person account
Record Type will be applied to business and person account records
respectively.</p>
</section>
<section id="extract">
<h4>Extract<a class="headerlink" href="#extract" title="Link to this heading">¶</a></h4>
<p>During dataset extraction, if the org has person accounts enabled, the
<code class="docutils literal notranslate"><span class="pre">IsPersonAccount</span></code> field is extracted for <strong>Account</strong> and <strong>Contact</strong>
records so CumulusCI can properly load these records later.
Additionally, <code class="docutils literal notranslate"><span class="pre">Account.Name</span></code> is not createable for person account
<strong>Account</strong> records, so <code class="docutils literal notranslate"><span class="pre">Account.Name</span></code> is not extracted for person
account <strong>Account</strong> records.</p>
</section>
<section id="load">
<h4>Load<a class="headerlink" href="#load" title="Link to this heading">¶</a></h4>
<p>Before loading, CumulusCI checks if the dataset contains any person
account records (i.e. any <strong>Account</strong> or <strong>Contact</strong> records with
<code class="docutils literal notranslate"><span class="pre">IsPersonAccount</span></code> as <code class="docutils literal notranslate"><span class="pre">true</span></code>). If the dataset does contain any person
account records, CumulusCI validates the org has person accounts
enabled.</p>
<p>You can enable person accounts for scratch orgs by including the
<a class="reference external" href="https://developer.salesforce.com/docs/atlas.en-us.sfdx_dev.meta/sfdx_dev/sfdx_dev_scratch-orgs_def_file_config_values.htm##so_personaccounts/">PersonAccounts</a>
feature in your scratch org definition.</p>
</section>
</section>
<section id="advanced-features">
<h3>Advanced Features<a class="headerlink" href="#advanced-features" title="Link to this heading">¶</a></h3>
<p>CumulusCI supports two additional keys within each step</p>
<p>The <code class="docutils literal notranslate"><span class="pre">filters</span></code> key encompasses filters applied to the SQL data store when
loading data. Use of <code class="docutils literal notranslate"><span class="pre">filters</span></code> can support use cases where only a subset
of stored data should be loaded. :</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;SQL</span><span class="nv"> </span><span class="s">string&quot;</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">filters</span></code> uses SQL syntax, not SOQL. Filters do not perform
filtration or data subsetting upon extraction; they only impact loading.
This is an advanced feature.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">static</span></code> key allows individual fields to be populated with a fixed,
static value:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">static</span><span class="p">:</span>
<span class="w">    </span><span class="nt">CustomCheckbox__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">CustomDateField__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2019-01-01</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">soql_filter</span></code> key lets you specify a WHERE clause that should be
used when extracting data from your Salesforce org:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Account</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Industry</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Type</span>
<span class="w">    </span><span class="nt">soql_filter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Industry</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;Higher</span><span class="nv"> </span><span class="s">Education&#39;</span><span class="nv"> </span><span class="s">OR</span><span class="nv"> </span><span class="s">Type</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;Higher</span><span class="nv"> </span><span class="s">Education&#39;&quot;</span>
</pre></div>
</div>
<p>Note that trying to load data that is extracted using <code class="docutils literal notranslate"><span class="pre">soql_filter</span></code> may
cause “invalid cross reference id” errors if related object records
are filtered on extract. Use this feature only if you fully understand
how <a class="reference internal" href="#data-load-dataset"><span class="std std-ref">CumulusCI load data task</span></a>
resolves references to related records when loading data to a Salesforce
org.</p>
<section id="primary-keys">
<h4>Primary Keys<a class="headerlink" href="#primary-keys" title="Link to this heading">¶</a></h4>
<p>CumulusCI offers two modes of managing Salesforce Ids and primary keys
within the stored database.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">fields</span></code> list for an sObject contains a mapping:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sf_id</span>
</pre></div>
</div>
<p>CumulusCI will extract the Salesforce Id for each record and use that Id
as the primary key in the stored database.</p>
<p>If no such mapping is provided, CumulusCI will remove the Salesforce Id
from extracted data and replace it with an autoincrementing integer
primary key.</p>
<p>Use of integer primary keys may help yield more readable text diffs when
storing data in SQL script format. However, it comes at some performance
penalty when extracting data. It’s recommended that most mappings do
not map the Id field and allow CumulusCI to utilize the automatic
primary key.</p>
</section>
<section id="handling-namespaces">
<h4>Handling Namespaces<a class="headerlink" href="#handling-namespaces" title="Link to this heading">¶</a></h4>
<p>All CumulusCI bulk data tasks support automatic namespace injection or
removal. In other words, the same mapping file will work for namespaced
and unnamespaced orgs, as well as orgs with the package installed
managed or unmanaged. If a mapping element has no namespace prefix and
adding the project’s namespace prefix is required to match a name in
the org, CumulusCI will add one. Similarly, if removing a namespace is
necessary, CumulusCI will do so.</p>
<p>In the extremely rare circumstance that an org contains the same mapped
schema element in both namespaced and non-namespaced form, CumulusCI
does not perform namespace injection or removal for that element.</p>
<p>Namespace injection can be deactivated by setting the
<code class="docutils literal notranslate"><span class="pre">inject_namespaces</span></code> option to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_dataset_mapping</span></code> generates mapping files with no namespace
and this is the most common pattern in CumulusCI projects.</p>
</section>
<section id="namespace-handing-with-multiple-mapping-files">
<h4>Namespace Handing with Multiple Mapping Files<a class="headerlink" href="#namespace-handing-with-multiple-mapping-files" title="Link to this heading">¶</a></h4>
<p>It’s also possible, and common in older managed package products, to
use multiple mapping files to achieve loading the same data set in both
namespaced and non-namespaced contexts. This is no longer recommended
practice.</p>
<p>A mapping file that is converted to use explicit namespacing might look
like this:</p>
<p>Original version:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Destinations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Destination__c</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="nt">Target__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Target__c</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">Supplier__c</span><span class="p">:</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Supplier__c</span>
</pre></div>
</div>
<p>Namespaced version:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Destinations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sf_object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyNS__Destination__c</span>
<span class="w">    </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Destination__c</span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span>
<span class="w">        </span><span class="nt">MyNS__Name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span>
<span class="w">        </span><span class="nt">MyNS__Target__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Target__c</span>
<span class="w">    </span><span class="nt">lookups</span><span class="p">:</span>
<span class="w">        </span><span class="nt">MyNS__Supplier__c</span><span class="p">:</span>
<span class="w">            </span><span class="nt">key_field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Supplier__c</span>
<span class="w">            </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Supplier__c</span>
</pre></div>
</div>
<p>Note that each of the definition elements that refer to <em>local</em> storage
remains un-namespaced, while those elements referring to the Salesforce
schema acquire the namespace prefix.</p>
<p>For each lookup, an additional <code class="docutils literal notranslate"><span class="pre">key_field</span></code> declaration is required,
whose value is the original storage location in local storage for that
field’s data. In most cases, this is simply the version of the field
name in the original definition file.</p>
<p>Adapting an originally-namespaced definition to load into a
non-namespaced org follows the same pattern, but in reverse.</p>
<p>Note that mappings which use the flat list style of field specification
must use mapping style to convert between namespaced and non-namespaced
deployment.</p>
<p>It’s recommended that all new mappings use flat list field
specifications and allow CumulusCI to manage namespace injection. This
capability typically results in significant simplication in automation.</p>
</section>
<section id="optional-data-elements">
<h4>Optional Data Elements<a class="headerlink" href="#optional-data-elements" title="Link to this heading">¶</a></h4>
<p>Some projects need to build datasets that include optional data
elements - fields and objects that are loaded into some of the
project’s orgs, but not others. This can cover both optional managed
packages and features that are included in some, but not all, orgs. For
example, a managed package A that does not require another managed
package B but is designed to work with it may wish to include data for
managed package B in its data sets, but load that data if and only if B
is installed. Likewise, a package might wish to include data supporting
a particular org feature, but not load that data in an org where the
feature is turned off (and its associated fields and objects are for
that reason unavailable).</p>
<p>To support this use case, the <code class="docutils literal notranslate"><span class="pre">load_dataset</span></code> and <code class="docutils literal notranslate"><span class="pre">extract_dataset</span></code> tasks
offer a <code class="docutils literal notranslate"><span class="pre">drop_missing_schema</span></code> option. When enabled, this option results
in CumulusCI ignoring any mapped fields, sObjects, or lookups that
correspond to schema that is not present in the org.</p>
<p>Projects that require this type of conditional behavior can build their
datasets in an org that contains managed package B, capture it, and then
load it safely in orgs that both do and do not contain B. However, it’s
important to always capture from an org with B present, or B data will
not be preserved in the dataset.</p>
</section>
</section>
</section>
<section id="custom-settings">
<h2>Custom Settings<a class="headerlink" href="#custom-settings" title="Link to this heading">¶</a></h2>
<p>Datasets don’t support Custom Settings. However, a separate task is
supplied to deploy Custom Settings (both list and hierarchy) into an
org: <a class="reference internal" href="tasks.html#load-custom-settings"><span class="std std-ref">load_custom_settings</span></a>. The data for this task is defined in a YAML
text file</p>
<p>Each top-level YAML key should be the API name of a Custom Setting. List
Custom Settings should contain a nested map of names to values.
Hierarchy Custom settings should contain a list, each of which contains
a <code class="docutils literal notranslate"><span class="pre">data</span></code> key and a <code class="docutils literal notranslate"><span class="pre">location</span></code> key. The
<code class="docutils literal notranslate"><span class="pre">location</span></code> key may contain either <code class="docutils literal notranslate"><span class="pre">profile:</span> <span class="pre">&lt;profile</span> <span class="pre">name&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">user:</span> <span class="pre">name:</span> <span class="pre">&lt;username&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">user:</span> <span class="pre">email:</span> <span class="pre">&lt;email&gt;</span></code>, or <code class="docutils literal notranslate"><span class="pre">org</span></code>.</p>
<p>Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">List__c</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Test</span><span class="p">:</span>
<span class="w">        </span><span class="nt">MyField__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">Test 2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">MyField__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">Hierarchy__c</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">org</span>
<span class="w">      </span><span class="nt">data</span><span class="p">:</span>
<span class="w">          </span><span class="nt">MyField__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span>
<span class="w">          </span><span class="nt">user</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test@example.com</span>
<span class="w">      </span><span class="nt">data</span><span class="p">:</span>
<span class="w">          </span><span class="nt">MyField__c</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
<p>CumulusCI will automatically resolve the <code class="docutils literal notranslate"><span class="pre">location</span></code> specified for
Hierarchy Custom Settings to a <code class="docutils literal notranslate"><span class="pre">SetupOwnerId</span></code>. Any Custom Settings
existing in the target org with the specified name (List) or setup owner
(Hierarchy) will be updated with the given data.</p>
</section>
<section id="dataset-tasks">
<h2>Dataset Tasks<a class="headerlink" href="#dataset-tasks" title="Link to this heading">¶</a></h2>
<section id="create-bulk-data-permission-set">
<h3><code class="docutils literal notranslate"><span class="pre">create_bulk_data_permission_set</span></code><a class="headerlink" href="#create-bulk-data-permission-set" title="Link to this heading">¶</a></h3>
<p>Create and assign a Permission Set that enables key features used in
Bulk Data tasks (Hard Delete and Set Audit Fields) for the current user.
The Permission Set will be called <code class="docutils literal notranslate"><span class="pre">CumulusCI</span> <span class="pre">Bulk</span> <span class="pre">Data</span></code>.</p>
<p>Note that prior to running this task you must ensure that your org is
configured to allow the use of Set Audit Fields. You can do so by
manually updating the required setting in the User Interface section of
Saleforce Setup, or by updating your scratch org configuration to
include :</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;securitySettings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enableAuditFieldsInactiveOwner&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about the Set Audit Fields feature, review <a class="reference external" href="https://help.salesforce.com/articleView?id=000213290&amp;amp;type=1">this
Knowledge
article</a>.</p>
<p>After this task runs, you’ll be able to run the <code class="docutils literal notranslate"><span class="pre">delete_data</span></code> task with
the <code class="docutils literal notranslate"><span class="pre">hardDelete</span></code> option, and you’ll be able to map audit fields like
<code class="docutils literal notranslate"><span class="pre">CreatedDate</span></code>.</p>
</section>
<section id="extract-dataset">
<h3><code class="docutils literal notranslate"><span class="pre">extract_dataset</span></code><a class="headerlink" href="#extract-dataset" title="Link to this heading">¶</a></h3>
<p>Extract the data for a dataset from an org and persist it to disk.</p>
<section id="options">
<h4>Options<a class="headerlink" href="#options" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mapping</span></code>: the path to the YAML definition file for this dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sql_path</span></code>: the path to a SQL script storage location for this
dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database_url</span></code>: the URL for the database storage location for this
dataset.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">mapping</span></code> and either <code class="docutils literal notranslate"><span class="pre">sql_path</span></code> or <code class="docutils literal notranslate"><span class="pre">database_url</span></code> must be supplied.</p>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cci task run extract_dataset -o mapping datasets/qa/mapping.yml -o sql_path datasets/qa/data.sql --org qa</span>
</pre></div>
</div>
</section>
</section>
<section id="load-dataset">
<span id="data-load-dataset"></span><h3><code class="docutils literal notranslate"><span class="pre">load_dataset</span></code><a class="headerlink" href="#load-dataset" title="Link to this heading">¶</a></h3>
<p>Load the data for a dataset into an org. If the storage is a database,
persist new Salesforce Ids to storage.</p>
<section id="id3">
<h4>Options<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mapping</span></code>: the path to the YAML definition file for this dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sql_path</span></code>: the path to a SQL script storage location for this
dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database_url</span></code>: the URL for the database storage location for this
dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start_step</span></code>: the name of the step to start the load with (skipping
all prior steps).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ignore_row_errors</span></code>: If True, allow the load to continue even if
individual rows fail to load. By default, the load stops if any
errors occur.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">mapping</span></code> and either <code class="docutils literal notranslate"><span class="pre">sql_path</span></code> or <code class="docutils literal notranslate"><span class="pre">database_url</span></code> must be supplied.</p>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cci task run load_dataset -o mapping datasets/qa/mapping.yml -o sql_path datasets/qa/data.sql --org qa</span>
</pre></div>
</div>
</section>
</section>
<section id="generate-dataset-mapping">
<h3><code class="docutils literal notranslate"><span class="pre">generate_dataset_mapping</span></code><a class="headerlink" href="#generate-dataset-mapping" title="Link to this heading">¶</a></h3>
<p>Inspect an org and generate a dataset definition for the schema found
there.</p>
<p>This task is intended to streamline the process of creating a dataset
definition. To use it, first build an org (scratch or persistent)
containing all of the schema needed for the dataset.</p>
<p>Then, execute <code class="docutils literal notranslate"><span class="pre">generate_dataset_mapping</span></code>. The task inspects the target
org and creates a dataset definition encompassing the project’s schema,
attempting to be minimal in its inclusion outside that schema.
Specifically, the definition will include:</p>
<ul class="simple">
<li><p>Any custom object without a namespace</p></li>
<li><p>Any custom object with the project’s namespace</p></li>
<li><p>Any object with a custom field matching the same namespace criteria</p></li>
<li><p>Any object that’s the target of a master-detail relationship, or a
custom lookup relationship, from another included object.</p></li>
</ul>
<p>On those sObjects, the definition will include</p>
<ul class="simple">
<li><p>Any custom field (including those defined by other packages)</p></li>
<li><p>Any required field</p></li>
<li><p>Any relationship field targeting another included object</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Id</span></code>, <code class="docutils literal notranslate"><span class="pre">FirstName</span></code>, <code class="docutils literal notranslate"><span class="pre">LastName</span></code>, and <code class="docutils literal notranslate"><span class="pre">Name</span></code> fields, if present</p></li>
</ul>
<p>Certain fields will always be omitted, including</p>
<ul class="simple">
<li><p>Lookups to the User object</p></li>
<li><p>Binary-blob (base64) fields</p></li>
<li><p>Compound fields</p></li>
<li><p>Non-createable fields</p></li>
</ul>
<p>The resulting definition file is intended to be a viable starting point
for a project’s dataset. However, some additional editing is typically
required to ensure the definition fully suits the project’s use case.
In particular, any fields required on standard objects that aren’t
automatically included must be added manually.</p>
<section id="reference-cycles">
<h4>Reference Cycles<a class="headerlink" href="#reference-cycles" title="Link to this heading">¶</a></h4>
<p>Dataset definition files must execute in a sequence, one sObject after
another. However, Salesforce schemas often include <em>reference cycles</em>:
situations in which Object A refers to Object B, which also refers to
Object A, or in which Object A refers to itself.</p>
<p>CumulusCI will detect these reference cycles during mapping generation
and ask the user for assistance resolving them into a linear sequence of
load and extract operations. In most cases, selecting the schema’s most
core object (often a standard object like Account) will successfully
resolve reference cycles. CumulusCI will automatically tag affected
relationship fields with <code class="docutils literal notranslate"><span class="pre">after</span></code> directives to ensure they’re populated
after their target records become available.</p>
</section>
<section id="id4">
<h4>Options<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: Location to write the mapping file. Default:
datasets/mapping.yml</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ignore</span></code>: Object API names, or fields in Object.Field format, to
ignore</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">namespace_prefix</span></code>: The namespace prefix to treat as belonging to
the project, if any</p></li>
</ul>
<p>Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cci task run generate_dataset_mapping --org qa -o namespace_prefix my_ns</span>
</pre></div>
</div>
</section>
</section>
<section id="load-custom-settings">
<h3><code class="docutils literal notranslate"><span class="pre">load_custom_settings</span></code><a class="headerlink" href="#load-custom-settings" title="Link to this heading">¶</a></h3>
<p>Load custom settings stored in YAML into an org.</p>
<section id="id5">
<h4>Options<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settings_path</span></code>: Location of the YAML settings file.</p></li>
</ul>
</section>
</section>
<section id="delete-data">
<h3><code class="docutils literal notranslate"><span class="pre">delete_data</span></code><a class="headerlink" href="#delete-data" title="Link to this heading">¶</a></h3>
<p>You can also delete records using CumulusCI. You can either delete every
record of a particular object, certain records based on a <code class="docutils literal notranslate"><span class="pre">where</span></code> clause
or every record of multiple objects. Because <code class="docutils literal notranslate"><span class="pre">where</span></code> clauses seldom make
logical sense when applied to multiple objects, you cannot use a <code class="docutils literal notranslate"><span class="pre">where</span></code>
clause when specifying multiple objects.</p>
<p>Details are available with <code class="docutils literal notranslate"><span class="pre">cci</span> <span class="pre">org</span> <span class="pre">info</span> <span class="pre">delete_data</span></code> and [in the task reference] (delete-data).</p>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cci</span> <span class="n">task</span> <span class="n">run</span> <span class="n">delete_data</span> <span class="o">-</span><span class="n">o</span> <span class="n">objects</span> <span class="n">Opportunity</span><span class="p">,</span><span class="n">Contact</span><span class="p">,</span><span class="n">Account</span> <span class="o">--</span><span class="n">org</span> <span class="n">qa</span>

<span class="n">cci</span> <span class="n">task</span> <span class="n">run</span> <span class="n">delete_data</span> <span class="o">-</span><span class="n">o</span> <span class="n">objects</span> <span class="n">Opportunity</span> <span class="o">-</span><span class="n">o</span> <span class="n">where</span> <span class="s2">&quot;StageName = &#39;Active&#39; &quot;</span>

<span class="n">cci</span> <span class="n">task</span> <span class="n">run</span> <span class="n">delete_data</span> <span class="o">-</span><span class="n">o</span> <span class="n">objects</span> <span class="n">Account</span> <span class="o">-</span><span class="n">o</span> <span class="n">ignore_row_errors</span> <span class="kc">True</span>

<span class="n">cci</span> <span class="n">task</span> <span class="n">run</span> <span class="n">delete_data</span> <span class="o">-</span><span class="n">o</span> <span class="n">objects</span> <span class="n">Account</span> <span class="o">-</span><span class="n">o</span> <span class="n">hardDelete</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
</section>
<section id="update-data">
<h3><code class="docutils literal notranslate"><span class="pre">update_data</span></code><a class="headerlink" href="#update-data" title="Link to this heading">¶</a></h3>
<p>To update records using CumulusCI, provide:</p>
<ul class="simple">
<li><p>a command line or task configuration describing what to update</p></li>
<li><p>a recipe in a subset of Snowfakery syntax that says how to update it</p></li>
</ul>
<p>On the command line, you can run an update like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cci</span> <span class="pre">task</span> <span class="pre">run</span> <span class="pre">update_data</span> <span class="pre">--recipe</span> <span class="pre">datasets/update.recipe.yml</span> <span class="pre">--object</span> <span class="pre">Account</span></code></p>
<p>This command downloads every Account in the org and applies the fields
from the specified update recipe file.</p>
<p>You can filter the rows that you’re updating like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cci</span> <span class="pre">task</span> <span class="pre">run</span> <span class="pre">update_data</span> <span class="pre">--recipe</span> <span class="pre">datasets/update.recipe.yml</span> <span class="pre">--object</span> <span class="pre">Account</span> <span class="pre">--where</span> <span class="pre">&quot;name</span> <span class="pre">like</span> <span class="pre">'AAA%'&quot;</span></code></p>
<p>The recipe for an update can be as simple as this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="nt">fields</span><span class="p">:</span>
<span class="w">    </span><span class="nt">NumberOfEmployees</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
</pre></div>
</div>
<p>You can use all of the power of <code class="docutils literal notranslate"><span class="pre">snowfakery</span></code> to add fake data:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="nt">fields</span><span class="p">:</span>
<span class="w">    </span><span class="nt">NumberOfEmployees</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10_000</span>
<span class="w">    </span><span class="nt">BillingStreet</span><span class="p">:</span>
<span class="w">        </span><span class="nt">fake</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Streetname</span>
</pre></div>
</div>
<p>Using Snowfakery formulas, you can also refer to specific input fields
like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">object</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="nt">fields</span><span class="p">:</span>
<span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{input.Name}} is our favorite customer in ${{input.BillingCity}}</span>
</pre></div>
</div>
<p>To tell CumulusCI to extract those fields and make them use the <code class="docutils literal notranslate"><span class="pre">fields</span></code>
option:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cci</span> <span class="pre">task</span> <span class="pre">run</span> <span class="pre">update_data</span> <span class="pre">--recipe</span> <span class="pre">datasets/update.recipe.yml</span> <span class="pre">--object</span> <span class="pre">Account</span> <span class="pre">--Fields</span> <span class="pre">Name,BillingCity</span></code></p>
<p>You can learn more about Snowfakery syntax in the next section.</p>
</section>
</section>
<section id="generate-fake-data">
<span id="id6"></span><h2>Generate Fake Data<a class="headerlink" href="#generate-fake-data" title="Link to this heading">¶</a></h2>
<p>It is possible to use CumulusCI to generate arbitrary amounts of
synthetic data using the <code class="docutils literal notranslate"><span class="pre">snowfakery</span></code>
<a class="reference external" href="https://cumulusci.readthedocs.io/en/latest/tasks.html#snowfakery">task</a>.
That task is built on the <a class="reference external" href="https://snowfakery.readthedocs.io/en/docs/">Snowfakery
language</a>. CumulusCI ships
with Snowfakery embedded, so you do not need to install it.</p>
<p>To start, you will need a Snowfakery recipe. You can learn about writing
them in the <a class="reference external" href="https://snowfakery.readthedocs.io/en/docs/">Snowfakery
docs</a>.</p>
<p>Once you have it, you can fill an org with data like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cci</span> <span class="pre">task</span> <span class="pre">run</span> <span class="pre">snowfakery</span> <span class="pre">--recipe</span> <span class="pre">datasets/some_snowfakery_recipe.yml</span></code></p>
<p>If you would like to execute the recipe multiple times to generate more
data, you do so like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cci</span> <span class="pre">task</span> <span class="pre">run</span> <span class="pre">generate_and_load_from_yaml</span> <span class="pre">--run-until-recipe-repeated</span> <span class="pre">400</span></code></p>
<p>Which will repeat the recipe 400 times.</p>
<p>There are two other ways to control how many times the recipe is
repeated: <code class="docutils literal notranslate"><span class="pre">--run-until-records-loaded</span></code> and
<code class="docutils literal notranslate"><span class="pre">--run-until-records-in-org</span></code>.</p>
<section id="generated-record-counts">
<h3>Generated Record Counts<a class="headerlink" href="#generated-record-counts" title="Link to this heading">¶</a></h3>
<p>Consider this example:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cci</span> <span class="pre">task</span> <span class="pre">run</span> <span class="pre">snowfakery</span> <span class="pre">--run-until-records-loaded</span> <span class="pre">1000:Account</span></code></p>
<p>This would say to run the recipe until the task has loaded 1000 new
Accounts. In the process, it might also load Contacts, Opportunities,
custom objects oor whatever else is in the recipe. But it finishes when
it has loaded 400 Accounts.</p>
<p>The counting works like this:</p>
<ul class="simple">
<li><p>Snowfakery always executes a <em>complete</em> recipe. It never stops
halfway through. If your recipe creates more records than you
need, you might overshoot. Usually the amount of overshoot is just
a few records, but it depends on the details of your recipe.</p></li>
<li><p>At the end of executing a recipe, it checks whether it has created
enough of the object type mentioned by the
<code class="docutils literal notranslate"><span class="pre">--run-until-records-loaded</span></code> parameter.</p></li>
<li><p>If so, it finishes. If not, it runs the recipe again.</p></li>
</ul>
<p>So if your recipe creates 10 Accounts, 5 Contacts and 15 Opportunities,
then when you run the command above it will run the recipe 100 times
(100*10=1000) which will generate 1000 Accounts, 500 Contacts and 1500
Opportunities.</p>
<p><code class="docutils literal notranslate"><span class="pre">--run-until-records-in-org</span></code>} works similarly, but it
determines how many times to run the recipe based on how many records
are in the org at the start. For example, if the org already has 300
Accounts in it then:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cci</span> <span class="pre">task</span> <span class="pre">run</span> <span class="pre">snowfakery</span> <span class="pre">--run-until-records-in-org</span> <span class="pre">1000:Account</span></code></p>
<p>Would be equivalent to <code class="docutils literal notranslate"><span class="pre">--run-until-records-loaded</span> <span class="pre">700:Account</span></code> because one needs to add 700 Accounts to the
300 resdent ones to get to 1000.</p>
</section>
<section id="controlling-the-loading-process">
<h3>Controlling the Loading Process<a class="headerlink" href="#controlling-the-loading-process" title="Link to this heading">¶</a></h3>
<p>CumulusCI’s data loader has many knobs and switches that you might want
to adjust during your load. It supports a
<a class="reference internal" href="data/loading_rules.html"><span class="std std-doc">“.load.yml”</span></a> file format
which allows you to manipulate these load settings. The simplest way to
use this file format is to make a file in the same directory as your
recipe with a filename that is derived from the recipe’s by replacing
everything after the first “.” with “.load.yml”. For example, if
your recipe is called “babka.recipe.yml” then your load file would be
“babka.load.yml”.</p>
</section>
<section id="batch-sizes">
<h3>Batch Sizes<a class="headerlink" href="#batch-sizes" title="Link to this heading">¶</a></h3>
<p>You can also control batch sizes with the <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">batch_size</span> <span class="pre">BATCHSIZE</span></code>
parameter. This is not the Salesforce bulk API batch size. No matter
what batch size you select, CumulusCI will properly split your data into
batches for the bulk API.</p>
<p>You need to understand the loading process to understand why you might
want to set the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>.</p>
<p>If you haven’t set the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> then Snowfakery generates all of
the records for your load job at once.</p>
<p>So the first reason why you might want to set the batch_size is because
you don’t have enough local disk space for the number of records you
are generating (across all tables).</p>
<p>This isn’t usually a problem though.</p>
<p>The more common problem arises from the fact that Salesforce bulk
uploads are always done in batches of records a particular SObject. So
in the case above, it would upload 1000 Accounts, then 500 Contacts,
then 1500 Opportunities. (remember that our scenario involves a recipe
that generates 10 Accounts, 5 Contacts and 15 Opportunities).</p>
<p>Imagine if the numbers were more like 1M, 500K and 1.5M. And further,
imagine if your network crashed after 1M Accounts and 499K Contacts were
uploaded. You would not have a single “complete set” of 10/5/15.
Instead you would have 1M “partial sets”.</p>
<p>If, by contrast, you had set your batch size to 100<em>000, your network
might die more around the 250,000 Account mark, but you would have
200,000/20<a class="footnote-reference brackets" href="#id8" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> =10K _complete sets</em> plus some “extra” Accounts which
you might ignore or delete. You can restart your load with a smaller
goal (800K Accounts) and finish the job.</p>
<p>Another reason you might choose smaller batch sizes is to minimize the
risk of row locking errors when you have triggers enabled. Turning off
triggers is generally preferable, and CumulusCI <a class="reference external" href="https://cumulusci.readthedocs.io/en/latest/tasks.html#disable-tdtm-trigger-handlers">has a
task</a>
for doing for TDTM trigger handlers, but sometimes you cannot avoid
them. Using smaller batch sizes may be preferable to switching to serial
mode. If every SObject in a batch uploads less than 10,000 rows then you
are defacto in serial mode (because only one “bulk mode batch” at a
time is being processed).</p>
<p>In general, bigger batch sizes achieve higher throughput. No batching at
all is the fastest.</p>
<p>Smaller batch sizes reduce the risk of something going wrong. You may
need to experiment to find the best batch size for your use case.</p>
</section>
</section>
</section>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">1</a><span class="fn-bracket">]</span></span>
<p>remember that our sets have 20 Accounts each</p>
</aside>
</aside>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="robot.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Acceptance Testing with Robot Framework</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="dev.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Develop a Project</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Salesforce.org
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Automate Data Operations</a><ul>
<li><a class="reference internal" href="#sample-data">Sample Data</a><ul>
<li><a class="reference internal" href="#extracting-and-loading-sample-datasets">Extracting and Loading Sample Datasets</a></li>
<li><a class="reference internal" href="#multiple-sample-datasets">Multiple Sample Datasets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#low-level-datasets">Low level datasets</a></li>
<li><a class="reference internal" href="#the-lifecycle-of-a-dataset">The Lifecycle of a Dataset</a></li>
<li><a class="reference internal" href="#defining-datasets">Defining Datasets</a><ul>
<li><a class="reference internal" href="#api-selection">API Selection</a></li>
<li><a class="reference internal" href="#upserts">Upserts</a></li>
<li><a class="reference internal" href="#selects">Selects</a><ul>
<li><a class="reference internal" href="#selection-strategies">Selection Strategies</a></li>
<li><a class="reference internal" href="#selection-filters">Selection Filters</a></li>
<li><a class="reference internal" href="#priority-fields">Priority Fields</a></li>
<li><a class="reference internal" href="#threshold">Threshold</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#database-mapping">Database Mapping</a></li>
<li><a class="reference internal" href="#record-types">Record Types</a></li>
<li><a class="reference internal" href="#relative-dates">Relative Dates</a></li>
<li><a class="reference internal" href="#person-accounts">Person Accounts</a><ul>
<li><a class="reference internal" href="#id2">Record Types</a></li>
<li><a class="reference internal" href="#extract">Extract</a></li>
<li><a class="reference internal" href="#load">Load</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-features">Advanced Features</a><ul>
<li><a class="reference internal" href="#primary-keys">Primary Keys</a></li>
<li><a class="reference internal" href="#handling-namespaces">Handling Namespaces</a></li>
<li><a class="reference internal" href="#namespace-handing-with-multiple-mapping-files">Namespace Handing with Multiple Mapping Files</a></li>
<li><a class="reference internal" href="#optional-data-elements">Optional Data Elements</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#custom-settings">Custom Settings</a></li>
<li><a class="reference internal" href="#dataset-tasks">Dataset Tasks</a><ul>
<li><a class="reference internal" href="#create-bulk-data-permission-set"><code class="docutils literal notranslate"><span class="pre">create_bulk_data_permission_set</span></code></a></li>
<li><a class="reference internal" href="#extract-dataset"><code class="docutils literal notranslate"><span class="pre">extract_dataset</span></code></a><ul>
<li><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#load-dataset"><code class="docutils literal notranslate"><span class="pre">load_dataset</span></code></a><ul>
<li><a class="reference internal" href="#id3">Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generate-dataset-mapping"><code class="docutils literal notranslate"><span class="pre">generate_dataset_mapping</span></code></a><ul>
<li><a class="reference internal" href="#reference-cycles">Reference Cycles</a></li>
<li><a class="reference internal" href="#id4">Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#load-custom-settings"><code class="docutils literal notranslate"><span class="pre">load_custom_settings</span></code></a><ul>
<li><a class="reference internal" href="#id5">Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#delete-data"><code class="docutils literal notranslate"><span class="pre">delete_data</span></code></a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-data"><code class="docutils literal notranslate"><span class="pre">update_data</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#generate-fake-data">Generate Fake Data</a><ul>
<li><a class="reference internal" href="#generated-record-counts">Generated Record Counts</a></li>
<li><a class="reference internal" href="#controlling-the-loading-process">Controlling the Loading Process</a></li>
<li><a class="reference internal" href="#batch-sizes">Batch Sizes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=dac0bbfe"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>