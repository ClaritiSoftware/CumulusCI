<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="author" title="About these documents" href="about.html" /><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Reference" href="reference.html" /><link rel="prev" title="Manage Unpackaged Configuration" href="unpackaged.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>Metadata ETL - CumulusCI 4.6.0.dev1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">CumulusCI 4.6.0.dev1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">CumulusCI 4.6.0.dev1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">The <code class="docutils literal notranslate"><span class="pre">cci</span></code> Command Line</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="config.html">Configure CumulusCI</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Configure CumulusCI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="deploy.html">Configure Metadata Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scratch-orgs.html">Manage Scratch Orgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="connected-orgs.html">Connect Persistent Orgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Develop a Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Automate Data Operations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="robot.html">Acceptance Testing with Robot Framework</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Acceptance Testing with Robot Framework</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="robot-locators.html">Managing Locators</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-advanced.html">Robot Advanced Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-tutorial.html">Robot Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-debugger.html">Robot Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="robot-playwright.html">Playwright Technology Preview</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="continuous-integration.html">Continuous Integration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Continuous Integration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="cumulusci-flow.html">CumulusCI Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="github-actions.html">Run CumulusCI from GitHub Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="2gp-testing.html">Testing with Second-Generation Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="headless.html">Run CumulusCI Headlessly</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="packaging.html">Release Managed and Unlocked Packages</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Release Managed and Unlocked Packages</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="managed-package.html">Release a First-Generation Managed Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="managed-2gp.html">Release a Second-Generation Managed Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="unlocked-package.html">Release an Unlocked Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="npsp-eda-2gp.html">Extend NPSP and EDA with Second-Generation Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="release-notes.html">Generate Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="push-upgrades.html">Manage Push Upgrades</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="unpackaged.html">Manage Unpackaged Configuration</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Manage Unpackaged Configuration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Metadata ETL</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="cheat-sheet.html">Cheat Sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="flows.html">Flow Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="env-var-reference.html">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="org_config-reference.html">org_config Object Reference</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="about.html">About CumulusCI</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of About CumulusCI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contribute to CumulusCI</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">History</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/metadata-etl.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="metadata-etl">
<h1>Metadata ETL<a class="headerlink" href="#metadata-etl" title="Link to this heading">¶</a></h1>
<section id="introduction-to-metadata-etl">
<h2>Introduction to Metadata ETL<a class="headerlink" href="#introduction-to-metadata-etl" title="Link to this heading">¶</a></h2>
<p>“ETL” refers to “extract, transform, and load” operations, usually
applied to data. CumulusCI offers a suite of functionality we call
<em>Metadata ETL</em>. Metadata ETL makes it easy to define automation that
executes targeted transformations of metadata that already exists in an
org.</p>
<p>Metadata ETL is particularly useful for building automation in projects
that extend other managed packages or that perform complex setup
operations during installations, such as through MetaDeploy. By using
Metadata ETL tasks, projects can often avoid storing and deploying
unpackaged metadata by instead extracting metadata from the target org,
making changes, and then re-deploying. This mode of configuration is
lower-risk and lower-maintenance than storing extensive unpackaged
metadata, which may become out-of-sync, incur accidental feature
dependencies, or entail more destructive deployment operations.</p>
<p>A primary example use case for Metadata ETL is deployment of Standard
Value Sets. Standard Value Sets, which define the picklist values
available on standard fields like <code class="docutils literal notranslate"><span class="pre">Opportunity.StageName</span></code>, are not
packageable, and as such must be part of an application’s unpackaged
metadata. They’re critical to many applications: a Business Process,
for example, will fail to deploy if the Stage values it includes are not
available. And lastly, they come with a serious danger for deployment
into subscriber orgs: deploying Standard Value Sets is an overwrite
operation, so all existing values in the target org that aren’t part of
the deployment are deactivated. This means that it’s neither safe nor
maintainable to store static Standard Value Set metadata in a project
and deploy it.</p>
<p>These three facets - non-packageability, application requirements, and
deployment safety -all support a Metadata ETL approach. Rather than
attempting to deploy static metadata stored in the repository, the
product’s automation should <em>extract</em> the Standard Value Set metadata
from the org, <em>transform</em> it to include the desired values (as well as
all existing customization), and <em>load</em> the transformed metadata back
into the org. CumulusCI now ships with a task,
<code class="docutils literal notranslate"><span class="pre">add_standard_value_set_entries</span></code>, that makes it easy to do just this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">add_standard_value_set_entries</span><span class="p">:</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">entries</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">fullName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New_Value&quot;</span>
<span class="w">              </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New</span><span class="nv"> </span><span class="s">Value&quot;</span>
<span class="w">              </span><span class="nt">closed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">        </span><span class="nt">api_names</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CaseStatus</span>
</pre></div>
</div>
<p>This task would retrieve the existing <code class="docutils literal notranslate"><span class="pre">Case.Status</span></code> picklist value set
from the org, add the <code class="docutils literal notranslate"><span class="pre">New_Value</span></code> entry to it, and redeploy the modified
metadata - ensuring that the application’s needs are met with a safe,
minimal intervention in the target org.</p>
</section>
<section id="standard-metadata-etl-tasks">
<h2>Standard Metadata ETL Tasks<a class="headerlink" href="#standard-metadata-etl-tasks" title="Link to this heading">¶</a></h2>
<p>CumulusCI includes several Metadata ETL tasks in its standard library.
For information about all of the available tasks, see <code class="docutils literal notranslate"><span class="pre">cci</span> <span class="pre">task</span> <span class="pre">list</span></code>
for tasks in the group Metadata Transformations.</p>
<p>Most Metadata ETL tasks accept the option <code class="docutils literal notranslate"><span class="pre">api_names</span></code>, which specifies
the developer names of the specific metadata components which should be
included in the operation. In most cases, more than one entity may be
transformed in a single operation. Each task performs a single Metadata
API retrieve and a single atomic deployment. Please note, however, that
the extract-transform-load operation as a whole is <em>not</em> atomic; it is
not safe to run Metadata ETL tasks in parallel or to mutate metadata by
other means during the run of a Metadata ETL task.</p>
<p>Consult the Task Reference or use the <code class="docutils literal notranslate"><span class="pre">cci</span> <span class="pre">task</span> <span class="pre">info</span></code> command for more
information on the usage of each task.</p>
<p>The Metadata ETL framework makes it easy to add more tasks. For
information about implementing Metadata ETL tasks, see TODO: link to
section in Python customization.</p>
</section>
<section id="namespace-injection">
<h2>Namespace Injection<a class="headerlink" href="#namespace-injection" title="Link to this heading">¶</a></h2>
<p>All out-of-the-box Metadata ETL tasks accept a Boolean <code class="docutils literal notranslate"><span class="pre">managed</span></code> option.
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, CumulusCI will replace the token <code class="docutils literal notranslate"><span class="pre">%%%NAMESPACE%%%</span></code> in API
names and in values used for transforming metadata with the project’s
namespace; if <code class="docutils literal notranslate"><span class="pre">False</span></code>, the token will simply be removed. See <a class="reference internal" href="unpackaged.html#namespace-injection"><span class="std std-ref">Namespace Injection</span></a> for more information.</p>
</section>
<section id="implementation-of-metadata-etl-tasks">
<h2>Implementation of Metadata ETL Tasks<a class="headerlink" href="#implementation-of-metadata-etl-tasks" title="Link to this heading">¶</a></h2>
<p>This section covers internals of the Metadata ETL framework, and is
intended for users who wish to build their own Metadata ETL tasks.</p>
<p>The Metadata ETL framework, and out-of-the-box Metadata ETL tasks, are
part of the <code class="docutils literal notranslate"><span class="pre">cumulusci.tasks.metadata_etl</span></code> package. The
<code class="docutils literal notranslate"><span class="pre">cumulusci.tasks.metadata_etl.base</span></code> module contains all of the base
classes inherited by Metadata ETL classes.</p>
<p>The easiest way to implement a Metadata ETL class that extracts,
transforms, and loads a specific entity, such as <code class="docutils literal notranslate"><span class="pre">CustomObject</span></code> or
<code class="docutils literal notranslate"><span class="pre">Layout</span></code>, is to subclass <code class="docutils literal notranslate"><span class="pre">MetadataSingleEntityTransformTask</span></code>.</p>
<p>This abstract base class has two override points: the class attribute
<code class="docutils literal notranslate"><span class="pre">entity</span></code> should be defined to the Metadata API entity that this class is
intended to transform, and the method
<code class="docutils literal notranslate"><span class="pre">_transform_entity(self,</span> <span class="pre">metadata:</span> <span class="pre">MetadataElement,</span> <span class="pre">api_name:</span> <span class="pre">str)</span></code> must
be overridden. This method should make any desired changes to the
supplied <code class="docutils literal notranslate"><span class="pre">MetadataElement</span></code>, and either return a <code class="docutils literal notranslate"><span class="pre">MetadataElement</span></code> for
deployment, or <code class="docutils literal notranslate"><span class="pre">None</span></code> to suppress deployment of this entity. Classes may
also opt to include their own options in <code class="docutils literal notranslate"><span class="pre">task_options</span></code>, but generally
should also incorporate the base class’s options, and override
<code class="docutils literal notranslate"><span class="pre">_init_options()</span></code> (<code class="docutils literal notranslate"><span class="pre">super</span></code>’s implementation should also be called to
ensure that supplied API names are processed appropriately).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SetDuplicateRuleStatus</span></code> class is a simple example of implementing a
<code class="docutils literal notranslate"><span class="pre">MetadataSingleEntityTransformTask</span></code> subclass, presented here with
additional comments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">cumulusci.tasks.metadata_etl</span><span class="w"> </span><span class="kn">import</span> <span class="n">MetadataSingleEntityTransformTask</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cumulusci.utils.xml.metadata_tree</span><span class="w"> </span><span class="kn">import</span> <span class="n">MetadataElement</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cumulusci.core.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">process_bool_arg</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SetDuplicateRuleStatus</span><span class="p">(</span><span class="n">MetadataSingleEntityTransformTask</span><span class="p">):</span>
    <span class="c1">## Subclasses *must* define `entity`</span>
    <span class="n">entity</span> <span class="o">=</span> <span class="s2">&quot;DuplicateRule&quot;</span>

    <span class="c1">## Most subclasses include the base class&#39;s options via</span>
    <span class="c1">## **MetadataSingleEntityTransformTask.task_options. Further</span>
    <span class="c1">## options may be added for this specific task. The base class</span>
    <span class="c1">## options include in particular the standard `api_names` option,</span>
    <span class="c1">## which base class functionality requires.</span>
    <span class="n">task_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Boolean value, set the Duplicate Rule to either active or inactive&quot;</span><span class="p">,</span>
            <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="o">**</span><span class="n">MetadataSingleEntityTransformTask</span><span class="o">.</span><span class="n">task_options</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1">## The `_transform_entity()` method must be overriden.</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_transform_entity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">MetadataElement</span><span class="p">,</span> <span class="n">api_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MetadataElement</span><span class="p">]:</span>
        <span class="c1">## This method modifies the supplied `MetadataElement`, using methods</span>
        <span class="c1">## from CumulusCI&#39;s metadata_tree module, to match the desired configuration.</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">process_bool_arg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">])</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;isActive&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">status</span>

        <span class="c1">## Always return the modified `MetadataElement` if deployment is desired.</span>
        <span class="c1">## To not deploy this element, return `None`.</span>
        <span class="k">return</span> <span class="n">metadata</span>
</pre></div>
</div>
<section id="advanced-metadata-etl-base-classes">
<h3>Advanced Metadata ETL Base Classes<a class="headerlink" href="#advanced-metadata-etl-base-classes" title="Link to this heading">¶</a></h3>
<p>Most Metadata ETL tasks subclass <code class="docutils literal notranslate"><span class="pre">MetadataSingleEntityTransformTask</span></code>.
However, the framework also includes classes that provide more
flexibility for complex metadata transformation and synthesis
operations.</p>
<p>The most general base class available is <code class="docutils literal notranslate"><span class="pre">BaseMetadataETLTask</span></code>. Concrete
tasks should rarely subclass <code class="docutils literal notranslate"><span class="pre">BaseMetadataETLTask</span></code>. Doing so requires
you to generate <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> content manually by overriding
<code class="docutils literal notranslate"><span class="pre">_get_package_xml_content()</span></code>, and requires you to override
<code class="docutils literal notranslate"><span class="pre">_transform()</span></code>, which directly accesses retrieved metadata files on disk
in <code class="docutils literal notranslate"><span class="pre">self.retrieve_dir</span></code> and places transformed versions into
<code class="docutils literal notranslate"><span class="pre">self.deploy_dir</span></code>. Subclasses must also set the Boolean class attributes
<code class="docutils literal notranslate"><span class="pre">deploy</span></code> and <code class="docutils literal notranslate"><span class="pre">retrieve</span></code> to define the desired mode of operation.</p>
<p>Tasks which wish to <em>synthesize</em> metadata, without doing a retrieval,
should subclass <code class="docutils literal notranslate"><span class="pre">BaseMetadataSynthesisTask</span></code>. Subclasses must override
<code class="docutils literal notranslate"><span class="pre">_synthesize()</span></code> to generate metadata files in <code class="docutils literal notranslate"><span class="pre">self.deploy_dir</span></code>. The
framework will automatically create a <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> and perform a
deployment.</p>
<p><code class="docutils literal notranslate"><span class="pre">BaseMetadataTransformTask</span></code> can be used as the base class for ETL tasks
that require more flexibility than is permitted by
<code class="docutils literal notranslate"><span class="pre">MetadataSingleEntityTransformTask</span></code>, such as tasks that must mutate
multiple Metadata API entities in a single operation. Subclasses must
override <code class="docutils literal notranslate"><span class="pre">_get_entities()</span></code> to return a dict mapping Metadata API
entities to collections of API names. (The base class will generate a
corresponding <code class="docutils literal notranslate"><span class="pre">package.xml</span></code>). Subclasses must also implement
<code class="docutils literal notranslate"><span class="pre">_transform()</span></code>, as with <code class="docutils literal notranslate"><span class="pre">BaseMetadataETLTask</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">UpdateFirstAttributeTextTask</span></code> is a base class and generic concrete task
that makes it easy to perform a specific, common transformation: setting
the value of the first instance of a specific top-level tag in a given
metadata entity. Subclasses (or tasks defined in <code class="docutils literal notranslate"><span class="pre">cumulusci.yml</span></code>) must
define the <code class="docutils literal notranslate"><span class="pre">entity</span></code>, targeted <code class="docutils literal notranslate"><span class="pre">attribute</span></code>, and desired <code class="docutils literal notranslate"><span class="pre">value</span></code> to set.
Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">assign_account_compact_layout</span><span class="p">:</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Assigns</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Fancy</span><span class="nv"> </span><span class="s">Compact</span><span class="nv"> </span><span class="s">Layout</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">Account&#39;s</span><span class="nv"> </span><span class="s">Compact</span><span class="nv"> </span><span class="s">Layout.&quot;</span>
<span class="w">    </span><span class="nt">class_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cumulusci.tasks.metadata_etl.UpdateFirstAttributeTextTask</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">        </span><span class="nt">managed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">        </span><span class="nt">namespace_inject</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$project_config.project__package__namespace</span>
<span class="w">        </span><span class="nt">entity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CustomObject</span>
<span class="w">        </span><span class="nt">api_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Account</span>
<span class="w">        </span><span class="nt">attribute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compactLayoutAssignment</span>
<span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%%%NAMESPACE%%%Fancy_Account_Compact_Layout&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="reference.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="unpackaged.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Manage Unpackaged Configuration</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Salesforce.org
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Metadata ETL</a><ul>
<li><a class="reference internal" href="#introduction-to-metadata-etl">Introduction to Metadata ETL</a></li>
<li><a class="reference internal" href="#standard-metadata-etl-tasks">Standard Metadata ETL Tasks</a></li>
<li><a class="reference internal" href="#namespace-injection">Namespace Injection</a></li>
<li><a class="reference internal" href="#implementation-of-metadata-etl-tasks">Implementation of Metadata ETL Tasks</a><ul>
<li><a class="reference internal" href="#advanced-metadata-etl-base-classes">Advanced Metadata ETL Base Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=dac0bbfe"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>